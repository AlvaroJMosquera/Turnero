<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Asignar Turnos</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4 bg-light">
  <div class="container">
    <h2 class="mb-4">Asignaci√≥n de Turnos para el Pr√≥ximo Mes</h2>

    <button class="btn btn-primary mb-3" onclick="generarAsignaciones()">üß† Generar Turnos</button>
    <a href="/" class="btn btn-secondary mb-3 ms-2">‚Üê Volver al Inicio</a>

    <div id="resultado" class="mt-4" style="display:none;">
      <h5>‚úÖ Turnos asignados correctamente:</h5>
      <table class="table table-bordered table-sm mt-3">
        <thead class="table-dark">
          <tr>
            <th>Fecha</th>
            <th>Turno</th>
            <th>Hora Entrada</th>
            <th>Hora Salida</th>
            <th>Trabajador</th>
            <th>Cargo</th>
            <th>Oficina</th>
          </tr>
        </thead>
        <tbody id="tablaAsignaciones"></tbody>
      </table>
    </div>
  </div>

  <script>
    async function generarAsignaciones() {
      const btn = event.target;
      btn.disabled = true;
      btn.innerText = "Asignando...";

      const res = await fetch("/asignaciones/generar/", {
        method: "POST"
      });

      btn.disabled = false;
      btn.innerText = "üß† Generar Turnos";

      if (res.ok) {
        const data = await res.json();
        const tabla = document.getElementById("tablaAsignaciones");
        const resultadoDiv = document.getElementById("resultado");
        tabla.innerHTML = "";

        data.resumen.forEach(item => {
          tabla.innerHTML += `
            <tr>
              <td>${item.fecha}</td>
              <td>${item.turno}</td>
              <td>${item.hora_inicio}</td>
              <td>${item.hora_fin}</td>
              <td>${item.trabajador}</td>
              <td>${item.cargo}</td>
              <td>${item.oficina}</td>
            </tr>
          `;
        });

        resultadoDiv.style.display = "block";
      } else {
        alert("‚ùå Ocurri√≥ un error al generar los turnos.");
      }
    }
  </script>
</body>
</html>
