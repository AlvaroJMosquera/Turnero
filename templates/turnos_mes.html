<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Turnos del Pr√≥ximo Mes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            padding-top: 30px;
        }
        .card {
            margin-bottom: 20px;
        }
        .btn-volver {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- üîô Bot√≥n para volver atr√°s -->
        <button class="btn btn-secondary btn-volver" onclick="window.history.back()">‚Üê Volver</button>

        <h1 class="text-center mb-4">Turnos del Pr√≥ximo Mes</h1>

        <!-- üîç Buscador por c√©dula -->
        <div class="mb-4">
            <input type="text" id="buscarCedula" class="form-control" placeholder="Buscar por c√©dula...">
        </div>

        <div id="turnos-container"></div>
    </div>

    <script>
        let dataTrabajadores = [];

        function renderCards(dataFiltrada) {
            const container = document.getElementById("turnos-container");
            container.innerHTML = "";

            dataFiltrada.forEach(item => {
                const card = document.createElement("div");
                card.className = "card shadow trabajador-card";
                card.setAttribute("data-cedula", item.cedula);

                card.innerHTML = `
                    <div class="card-body">
                        <h5 class="card-title">${item.trabajador}</h5>
                        <h6 class="card-subtitle mb-2 text-muted">C√©dula: ${item.cedula}</h6>
                        <ul class="list-group list-group-flush mt-3">
                            ${item.turnos.map(t => `
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    ${t.fecha}
                                    <span class="badge bg-${getColor(t.turno)}">${t.turno}</span>
                                </li>`).join("")}
                        </ul>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function getColor(turno) {
            switch (turno) {
                case "Ma√±ana": return "primary";
                case "Tarde": return "warning text-dark";
                case "Noche": return "dark";
                case "Libre": return "success";
                case "Vacaciones": return "danger";
                default: return "secondary";
            }
        }

        document.getElementById("buscarCedula").addEventListener("input", function () {
            const query = this.value.trim();
            const filtrados = dataTrabajadores.filter(t =>
                t.cedula.toString().includes(query)
            );
            renderCards(filtrados);
        });

        fetch("/schedule/next-month/")
            .then(res => res.json())
            .then(data => {
                dataTrabajadores = data;
                renderCards(dataTrabajadores);
            });
    </script>
</body>
</html>
